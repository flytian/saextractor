<?xml version="1.0" ?>
<!-- $Id: sem1.xml 885 2007-02-27 21:47:18Z labsky $ -->
<model name="seminars">

<import model="../datatypes.xml" />

<!-- functions used by some script axioms of the Contact class -->
<script src="sem.js" />

<!-- all references to resources below will be resolved relative to this base url -->
<base url="../shared"/>

<class id="Seminar" prune="0.05" counts="1" enabled="1"> <!-- counts="1" , counts="0-3"  -->

  <classifier id="cls1" classtype="attribute"
   name="ex.train.crf.CRFConnector"
   datasource="ex.train.WordSource"
   elements="speaker location stime etime"
   model="../seminars/crf50train">
    <feature type="model" />
    <param name="template"> res/template.crf </param>
    <param name="crf_dir"> ../crf_pp </param>
    <param name="tmp_dir"> tmp_crf </param>
    <param name="encoding"> utf-8 </param>
  </classifier>

<!--
  <classifier id="cls2" classtype="attribute" 
   name="ex.train.weka.WekaConnector" 
   datasource="ex.train.PhraseSource"
   elements="speaker location stime etime"
   model="../seminars/slse_smo_train">
    <feature type="model" />
    <feature type="ngram" ignore="case" length="1-2" minocc="2" maxcnt="150" mi="0.1, 10"  
             position="before, after, equals, prefix, suffix, content"
             source="document" book="../seminars/slse.fgram" />
    <param name="algorithm" value="weka.classifiers.functions.SMO" />
    <param name="options"> </param>
  </classifier>
-->

  <attribute id="speaker" type="name" card="0-1" eng="1" enabled="1" log="0">
    
    <!-- 1. titles -->
    
    <!-- single title patterns-->
    <pattern id="titles_pre" ignore="case">
     Miss | Lady | Sir | ( Mr | Mrs | Ms | Dr | Ing | Mgr | Bc ) .?
    </pattern>
    <pattern id="some_prof" ignore="case"> 
     (associate|assoc .?|assistant|assist .?)? <tok type="alpha"/>? (professor|prof .?) 
    </pattern>
    <pattern id="some_prof_of" ignore="case">
      <pattern ref="some_prof"/> (of <tok type="alpha"/> (and <tok type="alpha"/>)? )?
    </pattern>
    <pattern id="titles_suf" log="0">
     ( , <pattern ref="some_prof_of"/> )
     (( MSc | MSC | M . S | MA | MPh | MPH | MSPH | PhD | Ph . D | DrSc | Dr .? Sc | MBA | BA | M .? B .? A | MB | BM | MS | BS | MBBS | M . B . B . S | CAE | C . A . E
       MD | M . D | FRCP | F . R . C . P | MRCP | M . R . C . P | MRCPsych | FRCPsych | FACP | FACOG | F . R . C . Psych | F . R . C . P
       MRCPCH | MBChB | DRCOG | BChir | Bchir | B .? Chir | ChB | FRCS | FRCGP | FACS | F . A . C . S | F . A . C . P 
       LRCP | LNCP | MRCS | MRCOG | MRCGP | MBBChir ) .? )
     ( M.Sc. | M.S. | M.Ph. | Ph.D. | Dr.Sc. | M.B.A. | M.B. | B.S. | M.B.B.S.
       M.D. | F.R.C.P. | M.R.C.P. | F.R.C.Psych. | M.R.C.P.Ch. | M.B.Ch.B.
       Dr.C.O.G. | B.Chir. | Ch.B. | F.A.C.S. | F.A.C.P. | C.A.E. )
       Esq .?
    </pattern>
    <pattern id="titles_bi_1" ignore="case">
     docent | magister | <pattern ref="some_prof"/>
    </pattern>
    <pattern id="titles_bi">
     <pattern ref="titles_bi_1"/> 
     ( ( MUDr | MVDr | PhDr | BSc | Bsc | CSc | Doc | Prof | PharmDr | RNDr | RSDr | DiS 
         PaedDr | PaeDr | PhMr | MgA | JUDr | BcA | ThDr ) .? )
    </pattern>
    
    <!-- title arrays;-) -->
    <pattern id="titles_pre_arr" log="0">
     ((<pattern ref="titles_bi"/>|<pattern ref="titles_pre"/>) .? ,?)+
    </pattern>
    <pattern id="titles_suf_arr"> 
     (,? ((<pattern ref="titles_bi"/>|<pattern ref="titles_suf"/>) .?))+
    </pattern>
    <pattern id="titles_arr">
     ((<pattern ref="titles_bi"/>|<pattern ref="titles_pre"/>|<pattern ref="titles_suf"/>) (,|.)?)+
    </pattern>
  
    <!-- 2. name itself -->

    <pattern id="preamble" ignore="case"> (name | speaker | presenter | talk (by|with) | speak (to|with) | presented by | (seminar|lecture) by | who) :? </pattern>
    <pattern id="postamble" ignore="case" log="0">
      from | , (head|chief|member) of | , (researcher|professor) at | will speak 
      \( <tok/>{0,3} (institute|school|university|department|foundation|company|consortium|organization|research) <tok/>{0,3} \) 
    </pattern>
    <pattern id="initial"> ((A|B|C|D|E|F|G|H|I|J|K|L|M|N|O|P|R|S|T|U|V|W|X|Y|Z) .?) </pattern>
    <pattern id="nameaux" ignore="case"> (le|di|von|de) </pattern>
    <pattern id="middle"> <pattern ref="initial"/> | <pattern ref="nameaux"/> </pattern>
    <pattern id="jr" ignore="case"> junior | jr . | senior </pattern>
    <pattern id="firstname">
      <pattern src="names/en/first_male.txt" type="pattern" ignore="case" case="CA|UC" encoding="iso-8859-1" />
      <pattern src="names/en/first_female.txt" type="pattern" ignore="case" case="CA|UC" encoding="iso-8859-1" />
    </pattern>
    <pattern id="surname1">
      <pattern src="names/en/last18k.txt" type="pattern" ignore="case" case="CA|UC" encoding="iso-8859-1" />
    </pattern>
    <pattern id="surname_cn">
      <pattern src="names/en/last_cn.txt" type="pattern" ignore="case" case="CA|UC" encoding="iso-8859-1" />
    </pattern>
    <pattern id="surname2"> <pattern ref="surname_cn"/> | <pattern ref="surname1"/> </pattern>
    <pattern id="surname">
      <pattern ref="surname2"/>
      <pattern ref="surname2"/> - (<pattern ref="surname2"/> | <tok type="alpha|apos" case="CA|UC"/>)
      (<pattern ref="surname2"/> | <tok type="alpha|apos" case="CA|UC"/>) - <pattern ref="surname2"/>
      <tok>^[A-Z][a-z]*(man|mann|stein|sky|cky|ski|cky|ska|ov|ev|escu|ej|nen|son|elli|ato|dez|déz|tes|tés|rra|rras|ez|eau)$</tok>
      (van|von) <tok>^[A-Z][a-z]{3,15}$</tok>
      <tok>^Mc[A-Z][a-z]{3,15}$</tok> 
      <!-- JRE bug: adding ský|ská corrupts syntax of regexp if compiled with unicode and ignore case options! -->
    </pattern>
    <pattern id="cap"> <tok type="alpha|apos" case="CA|UC"/> </pattern>

    <!-- patterns directly used in value section -->
    <pattern id="bothknown">
      <pattern ref="initial"/>? <pattern ref="firstname"/> (<pattern ref="firstname"/>|<pattern ref="middle"/>|<tok type="alpha" case="CA">\w+</tok>){0,2} <pattern ref="surname" />
    </pattern>
    <pattern id="firstknown">
      <pattern ref="initial"/>? <pattern ref="firstname"/> (<pattern ref="firstname"/>|<pattern ref="middle"/>){0,2} <tok case="CA|UC" />
    </pattern>
    <pattern id="lastknown">
      <tok case="CA|UC"/> (-<tok case="CA|UC"/>)? <pattern ref="middle"/>{0,2} <pattern ref="surname" />
    </pattern>

	<!-- Speaker value -->
            
    <value>
      <or>
        <!-- OR group only uses the evidence in it which is observed and has the highest precision. 
             When no evidence is observed, coverage of each evidence is used separately to suppress the predicted attribute. -->
        <pattern id="v1" cover="0.02" p="0.8">
          <pattern ref="bothknown"/> (,? <pattern ref="jr"/>)?
        </pattern>
      
        <pattern id="v2" cover="0.02" p="0.7">
          <pattern ref="firstknown"/> (,? <pattern ref="jr"/>)?
        </pattern>
      
        <pattern id="v3" cover="0.02" p="0.6">
          <pattern ref="lastknown"/>
        </pattern>
        <pattern id="v4" cover="0.02" p="0.7">
          <pattern ref="lastknown"/> ,? <pattern ref="jr"/>
        </pattern>
      
        <pattern id="v5" cover="0.02" p="0.25">
          <pattern ref="surname"/>
        </pattern>
        <pattern id="v6" cover="0.02" p="0.75">
          <pattern ref="surname"/> ,? <pattern ref="jr"/>
        </pattern>
        <pattern id="v7" cover="0.02" p="0.7">
          <pattern ref="surname_cn"/>
        </pattern>
	  </or>
	  
	  <pattern id="unknown" log="0">
	    (<tok type="alpha|apos" case="CA|UC"/> -? | <tok>^[A-Z]$</tok> .? ){0,4} <tok type="alpha|apos" case="CA|UC" ignore="case">[a-z]{2,50}</tok>
	  </pattern>
	  <pattern id="valpats"> 
        <pattern ref="v1"/>|<pattern ref="v2"/>|<pattern ref="v3"/>|<pattern ref="v4"/>
        <pattern ref="v5"/>|<pattern ref="v6"/>|<pattern ref="v7"/>
      </pattern>
      
      <or>
	    <pattern id="t1" cover="0.02" p="0.9" log="0"> 
	      <pattern ref="titles_pre_arr"/> <pattern ref="valpats"/> <pattern ref="titles_suf_arr"/>? 
	    </pattern>
	    <pattern id="t2" cover="0.02" p="0.8" log="0">
	      <pattern ref="titles_pre_arr"/>? <pattern ref="valpats"/> <pattern ref="titles_suf_arr"/> 
	    </pattern>
	    <pattern id="t3" cover="0.02" p="0.7" log="0"> 
	      <pattern ref="titles_pre_arr"/> <pattern ref="unknown"/> <pattern ref="titles_suf_arr"/>? 
	    </pattern>
	    <pattern id="t4" cover="0.02" p="0.65" log="0">
	      <pattern ref="titles_pre_arr"/>? <pattern ref="unknown"/> <pattern ref="titles_suf_arr"/> 
	    </pattern>
      </or>
      
      <pattern type="script" cover="1" p="-1"> checkPersonName($) </pattern>

	  <!-- don't cross lines -->
      <pattern cover="0" p="0" log="0"> <tok/>{1,5} <lab name="BR"/> <tok/>{1,5} </pattern>

      <length> <distribution min="1" max="6" /> </length>
      <pattern cover="0.05" p="-1.0" type="format"> has_one_parent </pattern>
      <pattern cover="0.05" p="-1.0" type="format"> fits_in_parent </pattern>
      <pattern cover="0.6" p="-1.0" type="format"> no_crossed_inline_tags </pattern>
      <pattern cover="0.6" p="-1.0" type="format"> no_crossed_block_tags </pattern>
      
      <refers> nameRefersTo($, $other) </refers>
      
      <!-- refers to n-ary classifier of id="cls1" defined at class level -->
      <pattern id="cpat1" p="0.92" cover="0.02" feature="no" log="1"> <lab name="cls1.speaker" /> </pattern>
      <pattern id="cpat2" p="0.92" cover="0.02" feature="no" log="1"> <lab name="cls2.speaker" /> </pattern>
    </value>
    
    <!-- Speaker context -->
    
    <context>
      <pattern cover="0.02" p="0.75" ignore="case" log="0"> <pattern ref="preamble"/> $ </pattern>
      <pattern cover="0.02" p="0.2" ignore="case"> $ <pattern ref="postamble"/> </pattern>
      <pattern ignore="case" cover="0.02" p="0.1"> seminar (:|-)? $ </pattern>
      <pattern ignore="case" cover="0" p="0"> (posted by|postedby) :? (<tok/> <lab name="BR" neg="1"/>){0,30} $ </pattern>
      <pattern ignore="case" cover="0" p="0"> (host|hosted by) :? (<tok/> <lab name="BR" neg="1"/>){0,30} $ </pattern>
      <pattern ignore="case" cover="0" p="0"> (appointments|contact) :? (<tok/> <lab name="BR" neg="1"/>){0,30} $ </pattern>
      <pattern ignore="case" cover="0" p="0"> (moderator|moderated <tok/>{0,2} by) :? (<tok/> <lab name="BR" neg="1"/>){0,30} $ </pattern>
      
      <!-- ignore speakers scheduled for next seminars -->
      <pattern ignore="case" cover="0" p="0"> schedule <tok/>+ $ </pattern>
      
      <!-- ignore submitter and host -->
      <pattern ignore="case" cover="-1" p="0"> (posted by|postedby) :? $ </pattern>
      <pattern ignore="case" cover="-1" p="0"> (host|hosted by) :? $ </pattern>      
    </context>
  </attribute>
  
  <attribute id="speaker_lecturer" extends="speaker" enabled="1" log="0">
    <context>
      <pattern cover="0.02" p="0.2" ignore="case" log="0"> $ lecture </pattern>
      <pattern cover="0.02" p="0.3" ignore="case" log="0"> lecture by $ </pattern>
    </context>
  </attribute>
  
  <attribute id="time" type="name" card="0-2" eng="0.8" enabled="1" log="0">
    <context>
	  <pattern cover="0" p="0" ignore="case">
        $ : <tok>^[0-9]{2}$</tok> <!-- to prevent extracting hour when minutes follow -->
	  </pattern>
	  <pattern cover="0" p="0" ignore="case">
        (posted by|postedby|served|refreshments) :? (<tok/> <lab name="BR" neg="1"/>){0,10} (from|at) $
	  </pattern>
    </context>
    <pattern id="hr"> <tok>^(0?[1-9]|1[0-2])$</tok> </pattern>
    <pattern id="mi"> <tok>^[0-5][05]$</tok> </pattern>
    <pattern id="am" ignore="case" log="0"> (am|pm|a.m|p.m|a.m.|p.m.|a m|p m) .? </pattern>
    <pattern id="strong" ignore="case">
        <tok ignore="case">^(0?[1-9]|1[0-2])([:.][0-5][05])?[ap]m$</tok>
        <tok>^(0?[1-9]|1[0-2])([:.][0-5][05])$</tok>
        <pattern ref="hr"/> (:|.)? (<tok ignore="case">^([0-5][05])?[ap]m$</tok> | <pattern ref="mi"/>? <pattern ref="am"/> | <pattern ref="mi"/> <pattern ref="am"/>?)
        (12|12:00|12:15|12:30)? at? noon
        12noon
    </pattern>
    <pattern id="weak" ignore="case">
        <tok>^[1-9]$</tok>
	</pattern>
    
    <value>
      <or>
        <pattern cover="0.3" p="0.7" ignore="case"> <pattern ref="strong"/> </pattern>
	    <pattern cover="0.1" p="0.2" ignore="case"> <pattern ref="weak"/> </pattern>
	  </or>
	  
      <length> <distribution min="1" max="10" /> </length>
      <pattern cover="1" p="-1.0" type="format"> has_one_parent </pattern>
      <pattern cover="1" p="-1.0" type="format"> no_crossed_inline_tags </pattern>
      <pattern cover="1" p="-1.0" type="format"> no_crossed_block_tags </pattern>
      <pattern type="script" cover="1" p="-1"> parseTime($)!=null </pattern>
      
      <refers> sameTime($, $other) </refers>
    </value>
  </attribute>
  
  <attribute id="stime" type="name" card="0-1" extends="time" eng="1" enabled="1" log="0">
    <context>
      <pattern cover="0.02" p="0.3" ignore="case">
        ((starts|start|begin|begins) at? :? | start? time: | from :?) $
	  </pattern>
	  <pattern cover="0.02" p="0.1" ignore="case">
        at :? $
	  </pattern>
	  <pattern cover="0.02" p="0.3" ignore="case">
        $ (-|to|till|until) ($time | $etime)
	  </pattern>
    </context>
    <value>
      <refers> sameTime($, $other) </refers>
      <!-- refers to n-ary classifier of id="cls1" defined at class level -->
      <pattern p="0.88" cover="0.5" feature="no" log="1"> <lab name="cls1.stime" /> </pattern>
      <pattern p="0.88" cover="0.05" feature="no" log="1"> <lab name="cls2.stime" /> </pattern>
    </value>
  </attribute>

  <attribute id="etime" type="name" card="0-1" extends="time" eng="1" enabled="1" log="0">
    <context>
      <pattern cover="0.2" p="0.3" ignore="case">
        ((ends|end|stop|stops|terminates) at? :? | (end|stop) time: | (until|till) :?) $
	  </pattern>
	  <pattern cover="0.05" p="0.3" ignore="case">
        ($time | $stime) (-|to|till|until) $
	  </pattern>
    </context>
    <value>
      <refers> sameTime($, $other); </refers>
      <!-- refers to n-ary classifier of id="cls1" defined at class level -->
      <pattern p="0.84" cover="0.5" feature="no" log="1"> <lab name="cls1.etime" /> </pattern>
      <pattern p="0.84" cover="0.05" feature="no" log="1"> <lab name="cls2.etime" /> </pattern>
    </value>
  </attribute>
  
  <attribute id="location" type="name" card="0-2" eng="0.8" enabled="1" log="0">
    <context>
      <pattern cover="0.05" p="0.4" ignore="case">
        ( (location|place|room|auditorium|hall|where) : | (takes place|happens|is organized) (at|in)? :? ) $
	  </pattern>
	  <pattern cover="0.05" p="0.1">
	    (in|at) :? $ 
	  </pattern>
	  <pattern cover="-1" p="0"> " <lab neg="1" name="BR"/> $ </pattern>
	  <pattern cover="-1" p="0"> $ <lab neg="1" name="BR"/> " </pattern>
	  <pattern ignore="case" cover="0" p="0"> (posted by|postedby) :? (<tok/> <lab name="BR" neg="1"/>){0,30} $ </pattern>
    </context>
    <pattern id="hall" ignore="case">
      (lecture|seminar|conference)? (room|classroom|hall|auditorium|lounge){1,2}
    </pattern>
    <pattern id="inst" ignore="case">
      (research? (institute|lab))|university|college|building|school|library|wing
    </pattern>
    <pattern id="full_inst" ignore="case" log="0">
      <tok case="UC|CA"/>{1,3} <pattern ref="inst"/>
    </pattern>
    <pattern id="hall_id_weak" ignore="case" log="0">
      ( (<tok type="INT|ALPHANUM|NUMALPHA|FLOAT"/> 
         <tok type="ALPHA" case="UC"/>
         <tok>^[a-zA-Z]$</tok> ) (-|.|/|_)? ){1,3}
    </pattern>
    <pattern id="specials" ignore="case"> wean | weh </pattern>  
    <pattern id="hall_id_strong" ignore="case" log="0">
      (<pattern ref="specials"/> | <tok type="ALPHA" case="UC|CA"/>) <tok type="INT|ALPHANUM|NUMALPHA|FLOAT"/>
      <tok type="INT|ALPHANUM|NUMALPHA|FLOAT"/> (<pattern ref="specials"/> | <tok type="ALPHA" case="UC|CA"/>)
      <tok type="ALPHANUM"> \d{1,4}[A-Z]{1,2} </tok>
      <tok type="NUMALPHA"> [A-Z]{1,2}\d{1,4} </tok>
    </pattern>
    <pattern id="hall_id"> <pattern ref="hall_id_strong"/> | <pattern ref="hall_id_weak"/> </pattern>
    <pattern id="hall_name" ignore="case">
      ((1st|2nd|3rd|4th|5th|6th|7th|8th|9th|first|second|third|fourth|fifth|sixth|seventh|eighth|ninth) floor)? <tok case="UC|CA"/>{1,3}
    </pattern>
    <pattern id="located_in">
      ,? (situated|located)? in
    </pattern>
    <pattern id="L1_A" log="0">
                               <pattern ref="hall_name"/>? <pattern ref="inst"/>? <pattern ref="hall"/> <pattern ref="hall_id"/>? (,? <pattern ref="hall_name"/>? <pattern ref="hall"/> <pattern ref="hall_id"/>?)?
    </pattern>
    <pattern id="L1_B" log="0">
      <pattern ref="hall_id"/> <pattern ref="hall_name"/>? <pattern ref="inst"/>? <pattern ref="hall"/>                           (,? <pattern ref="hall_name"/>? <pattern ref="hall"/> <pattern ref="hall_id"/>?)?
    </pattern>
    <value>
      <or>
        <pattern id="L1" cover="0.1" p="0.95" log="0">
          (<pattern ref="full_inst"/> ,? )? (<pattern ref="L1_A"/> | <pattern ref="L1_B"/>)
          (<pattern ref="L1_A"/> | <pattern ref="L1_B"/>) ,? <pattern ref="full_inst"/>
        </pattern>
        <!-- covered by the above <pattern cover="0.1" p="0.85" log="0"> <pattern ref="hall"/> <pattern ref="hall_id"/> </pattern> -->
        <pattern id="L2a" cover="0.03" p="0.1" log="0">
          <pattern ref="hall_id_strong"/>
        </pattern>
        <pattern id="L2b" cover="0.03" p="0.07" log="0">
          <pattern ref="hall_id_weak"/>
        </pattern>
        <pattern id="L3" cover="0.03" p="0.95" log="0">
          (<pattern ref="L1"/>|<pattern ref="L2a"/>|<pattern ref="L2b"/>) <pattern ref="located_in"/> (<pattern ref="L1"/>|<pattern ref="L2a"/>|<pattern ref="L2b"/>)
        </pattern>
        <pattern id="L4" ignore="case" cover="0.03" p="0.8" log="0">
          (wean | weh) <tok type="INT|ALPHANUM|NUMALPHA|FLOAT"/>
          <tok type="INT|ALPHANUM|NUMALPHA|FLOAT"/> (wean | weh)
        </pattern>
        <pattern id="L5" ignore="case" cover="0.03" p="0.6" log="0">
          <tok type="INT|ALPHANUM|NUMALPHA|FLOAT"/> <pattern ref="full_inst"/>
          <pattern ref="full_inst"/> <tok type="INT|ALPHANUM|NUMALPHA|FLOAT"/>
        </pattern>
        <pattern id="L6" ignore="case" cover="0.03" p="0.58" log="0">
          <pattern ref="hall_id_strong"/>
        </pattern>
      </or>
      
      <pattern type="script" cover="1" p="-1"> checkRoomName($) </pattern>
      <length> <distribution min="1" max="10" /> </length>
      <pattern cover="1" p="-1.0" type="format"> has_one_parent </pattern>
      <pattern cover="1" p="-1.0" type="format"> no_crossed_inline_tags </pattern>
      <pattern cover="1" p="-1.0" type="format"> no_crossed_block_tags </pattern>
      
      <!-- refers to n-ary classifier of id="cls1" defined at class level -->
      <pattern p="0.7" cover="0.02" feature="no" log="1"> <lab name="cls1.location" /> </pattern>
      <pattern p="0.7" cover="0.02" feature="no" log="1"> <lab name="cls2.location" /> </pattern>
    </value>
  </attribute>

  <attribute id="date" type="date" card="0-50" eng="0.9" enabled="1">
    <value>
      <pattern p="0.9" cover="1">
        (<pattern ref="_datatypes.day_name"/> ,?)? (<pattern ref="_datatypes.month"/> <pattern ref="_datatypes.day"/>
        <pattern ref="_datatypes.day"/> of <pattern ref="_datatypes.month"/>) (,? <pattern ref="_datatypes.year"/>)? 
      </pattern>
    </value>
  </attribute>

</class>

<finally>
  <script> finalizeSeminar(); </script>
</finally>

</model>

